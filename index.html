<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SoundGuessr</title>
<style>
body {
    font-family: 'Poppins', sans-serif;
    margin:0; padding:0;
    background: #121212;
    display:flex; justify-content:center; align-items:center;
    min-height:100vh; color:#eee;
}

#container {
    background: #1e1e1e;
    width: 95%;
    max-width: 480px;
    border-radius: 20px;
    padding: 30px 20px;
    box-shadow:0 10px 20px rgba(0,0,0,0.5);
    text-align:center;
    transition:0.3s;
}

h1 {
    font-size:36px;
    margin-bottom:20px;
    color:#ff6b6b;
}

button {
    padding:15px 25px;
    margin:10px;
    font-size:18px;
    font-weight:bold;
    border-radius:14px;
    border:none;
    cursor:pointer;
    transition:0.2s;
}

#startBtn {
    background: linear-gradient(45deg,#ff6b6b,#ff9b6b);
    color:#fff;
    font-size:24px;
    width:80%;
    margin-top:20px;
    box-shadow:0 0 10px rgba(255,107,107,0.5);
}

#startBtn:disabled {
    cursor: default;
    opacity:0.6;
}

#playBtn {
    background: linear-gradient(45deg,#6bffb0,#00c2ff);
    color:#000;
    font-size:20px;
    box-shadow:0 0 10px rgba(0,194,255,0.5);
}

#playBtn:disabled { opacity:0.5; cursor: default; }

#guessBox input {
    width:90%;
    padding:12px;
    font-size:18px;
    border-radius:12px;
    border:2px solid #555;
    margin-top:15px;
    background:#2a2a2a;
    color:#eee;
}

#guessBox button {
    background: linear-gradient(45deg,#ff6b6b,#ff9b6b);
    color:#fff;
    font-size:18px;
    margin-top:10px;
    box-shadow:0 0 10px rgba(255,107,107,0.5);
}

#roundTimer {
    display:flex; justify-content:space-between;
    font-size:22px; margin-bottom:10px;
}

#timer {
    transition: all 0.3s ease;
}

.pulse {
    animation: pulse 0.7s infinite alternate;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

#progressContainer {
    width: 100%;
    height: 12px;
    background: #333;
    border-radius: 10px;
    margin-bottom: 15px;
}

#progressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,#4ec3ff,#ff6b6b);
    border-radius: 10px;
    transition: width 0.5s ease;
}

#info {
    font-size:16px; margin-top:8px; color:#ccc;
}

#result { font-size:22px; margin-top:20px; min-height:28px; }

#backBtn {
    background: linear-gradient(45deg,#ffa500,#ff6b6b);
    color:#fff;
    font-size:20px;
    padding:15px 25px;
    border-radius:14px;
    margin-top:15px;
    display:none;
    box-shadow:0 0 10px rgba(255,165,0,0.5);
}
</style>
</head>
<body>

<div id="container">
    <h1>üéß SoundGuessr</h1>

    <button id="startBtn" disabled>≈Åadowanie</button>

    <div id="gameArea" style="display:none;">
        <div id="progressContainer">
            <div id="progressBar"></div>
        </div>

        <div id="roundTimer">
            <div id="roundInfo">Runda 1 z 8</div>
            <div id="timer">30s</div>
        </div>

        <button id="playBtn" disabled>Odtwarzanie</button>
        <div id="info">Ka≈ºde dodatkowe odtworzenie: <b>-50 pkt</b></div>

        <div id="guessBox">
            <h2>Co to za d≈∫wiƒôk?</h2>
            <input id="answerInput" placeholder="np. Upadek Telefonu"
                   onkeydown="if(event.key==='Enter') checkAnswer()">
            <button onclick="checkAnswer()">Zatwierd≈∫</button>
        </div>

        <div id="result"></div>
        <button id="backBtn" onclick="location.reload()">Powr√≥t do menu g≈Ç√≥wnego</button>
    </div>
</div>

<script>
const GITHUB_API = "https://api.github.com/repos/SoundGuessr/soundguessr.github.io/contents/sounds";

let sounds=[], pool=[], current=null, audio=null;
let round=1, score=0, maxPoints=1000, timeLeft=30, timer;

let startBtn = document.getElementById("startBtn");
let playBtn = document.getElementById("playBtn");
let progressBar = document.getElementById("progressBar");
let timerEl = document.getElementById("timer");

let loadingTexts=["≈Åadowanie.","≈Åadowanie..","≈Åadowanie...","≈Åadowanie.","≈Åadowanie..","≈Åadowanie..."];
let loadingIndex=0;
let loadingInterval = setInterval(()=>{
    startBtn.innerText=loadingTexts[loadingIndex];
    loadingIndex=(loadingIndex+1)%loadingTexts.length;
}, 400);

fetch(GITHUB_API)
    .then(res=>res.json())
    .then(data=>{
        sounds=data.filter(x=>x.name.toLowerCase().endsWith(".m4a"))
                   .map(x=>({file:x.name,url:x.download_url}));
        clearInterval(loadingInterval);
        if(sounds.length===0){
            startBtn.innerText="Brak plik√≥w!";
            return;
        }
        startBtn.innerText="Graj";
        startBtn.disabled=false;
    })
    .catch(err=>{
        console.error(err);
        clearInterval(loadingInterval);
        startBtn.innerText="B≈ÇƒÖd!";
    });

startBtn.addEventListener("click",()=>{
    startBtn.style.display="none";
    document.getElementById("gameArea").style.display="block";
    startGame();
});

function startGame(){
    pool=[...sounds];
    round=1; score=0; maxPoints=1000;
    nextRound();
}

function updateProgress(){
    let percent = ((round-1)/8)*100;
    progressBar.style.width = percent + "%";
}

function nextRound(){
    document.getElementById("backBtn").style.display="none";
    if(audio) audio.pause(); // przerywamy poprzedni d≈∫wiƒôk

    if(round>8){
        progressBar.style.width="100%";
        document.getElementById("result").innerHTML="<b>Tw√≥j wynik: "+score+" pkt</b>";
        playBtn.style.display="none";
        document.getElementById("guessBox").style.display="none";
        document.getElementById("backBtn").style.display="inline-block";
        document.getElementById("roundInfo").innerText="";
        timerEl.innerText="";
        return;
    }

    updateProgress();

    const idx=Math.floor(Math.random()*pool.length);
    current=pool.splice(idx,1)[0];

    document.getElementById("roundInfo").innerText=`Runda ${round} z 8`;
    timerEl.innerText="30s";
    timerEl.classList.remove("pulse");
    document.getElementById("guessBox").style.display="block";
    document.getElementById("answerInput").value="";
    document.getElementById("result").innerText="";
    
    playBtn.innerText="Odtwarzanie";
    playBtn.disabled=true;

    audio=new Audio(current.url);
    audio.onended = ()=>{
        playBtn.innerText="Odtw√≥rz ponownie";
        playBtn.disabled=false;
    }

    audio.play();
    startTimer();
}

function startTimer(){
    clearInterval(timer);
    timeLeft=30;
    timerEl.style.color="#eee";
    timerEl.classList.remove("pulse");

    timer=setInterval(()=>{
        timerEl.innerText=timeLeft+"s";
        if(timeLeft<=10 && timeLeft>=6){
            timerEl.style.color="orange";
        } else if(timeLeft<=5 && timeLeft>=3){
            timerEl.style.color="red";
        } else if(timeLeft<=2){
            timerEl.style.color="#ff1a1a";
            timerEl.classList.add("pulse");
        } else {
            timerEl.style.color="#eee";
            timerEl.classList.remove("pulse");
        }
        timeLeft--;
        if(timeLeft<0){
            clearInterval(timer);
            handleAnswer(false);
        }
    },1000);
}

function playSound(){
    audio.play();
    maxPoints-=50;
    if(maxPoints<0) maxPoints=0;
    playBtn.disabled=true;
    playBtn.innerText="ZABLOKOWANY (Odtwarzanie)";
    audio.onended = ()=>{
        playBtn.innerText="Odtw√≥rz ponownie";
        playBtn.disabled=false;
    }
}

function formatName(f){
    return f.replace(".m4a","").replace(/[-_]/g," ").split(" ").map(w=>w.charAt(0).toUpperCase()+w.slice(1)).join(" ");
}

function checkAnswer(){
    const typed=document.getElementById("answerInput").value.trim().toLowerCase();
    const correct=formatName(current.file).toLowerCase();
    handleAnswer(typed.length>0 && correct.includes(typed));
}

function handleAnswer(ok){
    clearInterval(timer);
    if(ok){
        score+=maxPoints;
        document.getElementById("result").innerHTML=`<span style="color:#2ecc71;">‚úî Dobrze! +${maxPoints} pkt</span>`;
    }else{
        document.getElementById("result").innerHTML=`<span style="color:#e74c3c;">‚úò ≈πle! To by≈Ço: ${formatName(current.file)}</span>`;
    }
    maxPoints=1000;
    round++;
    setTimeout(nextRound,1500);
}
</script>
</body>
</html>
