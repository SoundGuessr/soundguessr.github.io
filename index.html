<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SoundGuessr</title>
<style>
    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: #f0f4f8;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #222;
    }

    #container {
        background: #fff;
        width: 95%;
        max-width: 480px;
        border-radius: 20px;
        padding: 30px 20px;
        box-shadow: 0 15px 25px rgba(0,0,0,0.15);
        text-align: center;
        transition: 0.3s;
    }

    h1 {
        font-size: 36px;
        margin-bottom: 20px;
        color: #ff6b6b;
    }

    button {
        padding: 15px 25px;
        margin: 10px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 14px;
        border: none;
        cursor: pointer;
        transition: 0.2s;
    }

    #startBtn {
        background: linear-gradient(45deg, #ffd56b, #ff6b6b);
        color: #fff;
        font-size: 24px;
        width: 80%;
        margin-top: 20px;
    }

    #startBtn:hover { transform: scale(1.05); }

    #playBtn {
        background: linear-gradient(45deg, #6bffb0, #00c2ff);
        color: #fff;
        font-size: 20px;
    }

    #playBtn:hover { transform: scale(1.05); }

    #guessBox input {
        width: 90%;
        padding: 12px;
        font-size: 18px;
        border-radius: 12px;
        border: 2px solid #ddd;
        margin-top: 15px;
    }

    #guessBox button {
        background: linear-gradient(45deg, #ff6b6b, #ffd56b);
        color: #fff;
        font-size: 18px;
        margin-top: 10px;
    }

    #roundInfo {
        font-size: 24px;
        margin-bottom: 10px;
        color: #4ec3ff;
    }

    #timer {
        font-size: 36px;
        margin: 10px 0;
        font-weight: bold;
        color: #ff6b6b;
    }

    #info {
        font-size: 16px;
        margin-top: 8px;
        color: #555;
    }

    #result {
        font-size: 22px;
        margin-top: 20px;
        min-height: 28px;
    }
</style>
</head>
<body>

<div id="container">
    <h1>üéß SoundGuessr</h1>

    <div id="state">≈Åadowanie d≈∫wiƒôk√≥w‚Ä¶</div>

    <button id="startBtn" onclick="startGame()" style="display:none;">START</button>

    <div id="gameArea" style="display:none;">
        <div id="roundInfo"></div>
        <div id="timer"></div>

        <button id="playBtn" onclick="playSound()">‚ñ∂ ODTW√ìRZ D≈πWIƒòK</button>
        <div id="info">Ka≈ºde dodatkowe odtworzenie: <b>-50 pkt</b></div>

        <div id="guessBox">
            <h2>Co to za d≈∫wiƒôk?</h2>
            <input id="answerInput" placeholder="np. Upadek Telefonu"
                   onkeydown="if(event.key==='Enter') checkAnswer()">
            <button onclick="checkAnswer()">Zatwierd≈∫</button>
        </div>

        <div id="result"></div>
    </div>
</div>

<script>
const GITHUB_API = "https://api.github.com/repos/SoundGuessr/soundguessr.github.io/contents/sounds";

let sounds = [];
let pool = [];
let current = null;
let audio = null;

let round = 1;
let score = 0;
let maxPoints = 1000;
let timeLeft = 30;
let timer;

fetch(GITHUB_API)
    .then(res => res.json())
    .then(data => {
        sounds = data
            .filter(x => x.name.toLowerCase().endsWith(".m4a"))
            .map(x => ({ file: x.name, url: x.download_url }));

        if(sounds.length===0){
            document.getElementById("state").innerText = "Brak plik√≥w .m4a!";
            return;
        }

        document.getElementById("state").innerText = "Gotowe!";
        document.getElementById("startBtn").style.display = "inline-block";
    })
    .catch(err => {
        console.error(err);
        document.getElementById("state").innerText = "B≈ÇƒÖd pobierania plik√≥w!";
    });

function startGame(){
    pool = [...sounds];
    round = 1;
    score = 0;
    maxPoints = 1000;

    document.getElementById("startBtn").style.display = "none";
    document.getElementById("state").style.display = "none";
    document.getElementById("gameArea").style.display = "block";

    nextRound();
}

function nextRound(){
    if(round>8){
        document.getElementById("roundInfo").innerText="";
        document.getElementById("timer").innerText="";
        document.getElementById("info").style.display="none";
        document.getElementById("playBtn").style.display="none";
        document.getElementById("guessBox").style.display="none";
        document.getElementById("result").innerHTML = "<b>Tw√≥j wynik: "+score+" pkt</b>";
        return;
    }

    const idx = Math.floor(Math.random()*pool.length);
    current = pool.splice(idx,1)[0];

    document.getElementById("roundInfo").innerText = `Runda ${round} z 8`;
    document.getElementById("guessBox").style.display="block";
    document.getElementById("answerInput").value="";
    document.getElementById("result").innerText="";

    audio = new Audio(current.url);
    audio.play();

    startTimer();
}

function startTimer(){
    clearInterval(timer);
    timeLeft = 30;

    timer = setInterval(()=>{
        document.getElementById("timer").innerText = timeLeft + "s";
        timeLeft--;
        if(timeLeft<0){
            clearInterval(timer);
            handleAnswer(false);
        }
    },1000);
}

function playSound(){
    audio.play();
    maxPoints-=50;
    if(maxPoints<0) maxPoints=0;
}

function formatName(f){
    return f.replace(".m4a","")
            .replace(/[-_]/g," ")
            .split(" ")
            .map(w=>w.charAt(0).toUpperCase()+w.slice(1))
            .join(" ");
}

function checkAnswer(){
    const typed=document.getElementById("answerInput").value.trim().toLowerCase();
    const correct=formatName(current.file).toLowerCase();
    const ok=typed.length>0 && correct.includes(typed);
    handleAnswer(ok);
}

function handleAnswer(ok){
    clearInterval(timer);
    if(ok){
        score+=maxPoints;
        document.getElementById("result").innerHTML=`<span style="color:#2ecc71;">‚úî Dobrze! +${maxPoints} pkt</span>`;
    }else{
        document.getElementById("result").innerHTML=`<span style="color:#e74c3c;">‚úò ≈πle! To by≈Ço: ${formatName(current.file)}</span>`;
    }
    maxPoints=1000;
    round++;
    setTimeout(nextRound,1500);
}
</script>
</body>
</html>
