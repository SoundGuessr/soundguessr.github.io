<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SoundGuessr</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0e0e0e;
        color: #fff;
        text-align: center;
        margin: 0;
        padding: 0;
    }

    h1 {
        margin-top: 40px;
        font-size: 42px;
        color: #4ec3ff;
    }

    #container {
        margin: 40px auto;
        width: 90%;
        max-width: 500px;
        background: #181818;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    button {
        padding: 14px 26px;
        margin: 10px;
        font-size: 20px;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        background: #4ec3ff;
        color: #000;
        font-weight: bold;
        transition: 0.2s;
    }

    button:hover {
        background: #76d4ff;
    }

    #bigButton {
        width: 100%;
        background: #4ec3ff;
        font-size: 28px;
        padding: 20px;
        margin-top: 20px;
    }

    #info {
        font-size: 22px;
        margin: 15px 0;
        color: #ccc;
    }

    #roundInfo {
        font-size: 26px;
        margin: 20px 0;
        color: #4ec3ff;
    }

    #timer {
        font-size: 40px;
        margin: 10px 0;
        color: #ff5252;
    }

    #guessBox {
        margin-top: 20px;
        display: none;
    }

    input {
        width: 90%;
        padding: 12px;
        font-size: 20px;
        border: none;
        border-radius: 8px;
    }

    #result {
        margin-top: 20px;
        font-size: 26px;
    }
</style>
</head>
<body>

<h1>üéß SoundGuessr</h1>

<div id="container">

    <div id="state">≈Åadowanie d≈∫wiƒôk√≥w‚Ä¶</div>

    <button id="startBtn" onclick="startGame()" style="display:none;">START</button>

    <div id="gameArea" style="display:none;">
        <div id="roundInfo"></div>
        <div id="timer"></div>

        <button id="playBtn" onclick="playSound()" style="margin-top:20px;">‚ñ∂ ODTW√ìRZ D≈πWIƒòK</button>
        <div id="info">Ka≈ºde dodatkowe odtworzenie: <b>-50 pkt</b></div>

        <div id="guessBox">
            <h2>Co to za d≈∫wiƒôk?</h2>
            <input id="answerInput" placeholder="np. Upadek Telefonu"
                   onkeydown="if(event.key==='Enter') checkAnswer()">
            <button onclick="checkAnswer()">Zatwierd≈∫</button>
        </div>

        <div id="result"></div>
    </div>

</div>


<script>
const GITHUB_API = "https://api.github.com/repos/SoundGuessr/soundguessr.github.io/contents/sounds";

let sounds = [];
let pool = [];
let current = null;
let audio = null;

let round = 1;
let score = 0;
let maxPoints = 1000;

let timeLeft = 30;
let timer;

fetch(GITHUB_API)
    .then(res => res.json())
    .then(data => {
        sounds = data
            .filter(x => x.name.toLowerCase().endsWith(".m4a"))
            .map(x => ({ file: x.name, url: x.download_url }));

        if (sounds.length === 0) {
            document.getElementById("state").innerText = "Brak plik√≥w .m4a!";
            return;
        }

        document.getElementById("state").innerText = "Wszystko gotowe!";
        document.getElementById("startBtn").style.display = "inline-block";
    });

function startGame() {
    pool = [...sounds];
    round = 1;
    score = 0;
    maxPoints = 1000;

    document.getElementById("startBtn").style.display = "none";
    document.getElementById("state").style.display = "none";
    document.getElementById("gameArea").style.display = "block";

    nextRound();
}

function nextRound() {
    if (round > 8) {
        document.getElementById("roundInfo").innerText = "";
        document.getElementById("timer").innerText = "";
        document.getElementById("info").style.display = "none";
        document.getElementById("playBtn").style.display = "none";
        document.getElementById("guessBox").style.display = "none";
        document.getElementById("result").innerHTML = "<br><b>Tw√≥j wynik: " + score + " pkt</b>";
        return;
    }

    const idx = Math.floor(Math.random() * pool.length);
    current = pool.splice(idx, 1)[0];

    document.getElementById("roundInfo").innerText = `Runda ${round} z 8`;
    document.getElementById("guessBox").style.display = "block";
    document.getElementById("answerInput").value = "";
    document.getElementById("result").innerText = "";

    audio = new Audio(current.url);
    audio.play();

    startTimer();
}

function startTimer() {
    clearInterval(timer);
    timeLeft = 30;

    timer = setInterval(() => {
        document.getElementById("timer").innerText = timeLeft + "s";
        timeLeft--;

        if (timeLeft < 0) {
            clearInterval(timer);
            handleAnswer(false);
        }
    }, 1000);
}

function playSound() {
    audio.play();
    maxPoints -= 50;
    if (maxPoints < 0) maxPoints = 0;
}

function formatName(f) {
    return f.replace(".m4a", "")
            .replace(/[-_]/g, " ")
            .split(" ")
            .map(w => w.charAt(0).toUpperCase() + w.slice(1))
            .join(" ");
}

function checkAnswer() {
    const typed = document.getElementById("answerInput").value.trim().toLowerCase();
    const correct = formatName(current.file).toLowerCase();

    const ok = typed.length > 0 && correct.includes(typed);

    handleAnswer(ok);
}

function handleAnswer(ok) {
    clearInterval(timer);

    if (ok) {
        score += maxPoints;
        document.getElementById("result").innerHTML =
            `<span style="color:#5dff80;">‚úî Dobrze! +${maxPoints} pkt</span>`;
    } else {
        document.getElementById("result").innerHTML =
            `<span style="color:#ff6b6b;">‚úò ≈πle! To by≈Ço: ${formatName(current.file)}</span>`;
    }

    maxPoints = 1000;
    round++;

    setTimeout(nextRound, 1500);
}
</script>

</body>
</html>
