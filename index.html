<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SoundGuessr</title>
<style>
body { font-family: Arial; background:#111; color:#eee; text-align:center; padding:40px; }
button { padding:12px 24px; font-size:18px; border:none; border-radius:8px; margin:10px; cursor:pointer; }
input { padding:10px; width:80%; font-size:16px; border-radius:6px; border:none; margin-top:10px; }
#gameBox { background:#1d1d1d; padding:25px; border-radius:12px; width:80%; max-width:450px; margin:auto; }
</style>
</head>
<body>

<h1>üéß SoundGuessr</h1>
<div id="gameBox">
    <div id="status">≈Åadowanie d≈∫wiƒôk√≥w‚Ä¶</div>

    <button onclick="startGame()">START</button>
    <button onclick="repeatSound()">Odtw√≥rz ponownie (-50 pkt)</button>

    <br>
    <input id="answerInput" placeholder="Co to za d≈∫wiƒôk?" onkeydown="if(event.key==='Enter') checkAnswer()">
    <button onclick="checkAnswer()">OK</button>

    <div id="result"></div>
</div>

<script>
let soundList = [];    // lista plik√≥w z JSON
let pool = [];         // lista miksowana na rundƒô
let current = "";      // aktualny plik
let audio = null;
let round = 1;
let score = 0;
let maxPoints = 1000;
let timeLeft = 30;
let timer;

// --------------- ≈ÅADOWANIE D≈πWIƒòK√ìW Z JSON -------------------

fetch("sounds/sounds.json")
    .then(res => res.json())
    .then(data => {
        soundList = data.files;
        document.getElementById("status").innerText = "Kliknij START, aby zaczƒÖƒá!";
    })
    .catch(err => {
        document.getElementById("status").innerText = "B≈ÇƒÖd ≈Çadowania plik√≥w!";
        console.error(err);
    });

// --------------- FUNKCJE GRY -------------------

function startGame() {
    pool = [...soundList];
    round = 1;
    score = 0;
    maxPoints = 1000;
    nextRound();
}

function nextRound() {
    if (round > 8) {
        document.getElementById("status").innerText = "Koniec gry! Wynik: " + score;
        return;
    }

    // losowanie pliku
    const idx = Math.floor(Math.random() * pool.length);
    current = pool.splice(idx, 1)[0];

    // odtwarzanie
    audio = new Audio("sounds/" + current);
    audio.play();

    // start timera
    startTimer();

    document.getElementById("status").innerText =
        "Runda " + round + " z 8 ‚Ä¢ 30s";
}

function repeatSound() {
    if (!audio) return;
    maxPoints -= 50;
    if (maxPoints < 0) maxPoints = 0;
    audio.play();
}

function startTimer() {
    clearInterval(timer);
    timeLeft = 30;

    timer = setInterval(() => {
        document.getElementById("status").innerText =
            "Runda " + round + " z 8 ‚Ä¢ " + timeLeft + "s";
        timeLeft--;

        if (timeLeft < 0) {
            clearInterval(timer);
            handleAnswer(false);
        }
    }, 1000);
}

function convertName(filename) {
    // usu≈Ñ rozszerzenie
    const name = filename.replace(/\.[^/.]+$/, "");

    return name
        .replace(/[-_]/g, " ")                // my≈õlniki -> spacje
        .split(" ")
        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
        .join(" ");
}

function checkAnswer() {
    const answer = document.getElementById("answerInput").value.trim().toLowerCase();
    const correctName = convertName(current).toLowerCase();

    const isCorrect = answer !== "" && correctName.includes(answer);

    handleAnswer(isCorrect);
}

function handleAnswer(correct) {
    clearInterval(timer);

    const pretty = convertName(current);

    if (correct) {
        score += maxPoints;
        document.getElementById("result").innerText =
            "‚úîÔ∏è Dobrze! +" + maxPoints + " pkt";
    } else {
        document.getElementById("result").innerText =
            "‚ùå ≈πle! To by≈Ço: " + pretty;
    }

    maxPoints = 1000;
    round++;

    setTimeout(() => {
        document.getElementById("result").innerText = "";
        nextRound();
    }, 1500);
}
</script>

</body>
</html>
