<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SoundGuessr</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #121212;
        color: #eee;
        text-align: center;
        padding: 40px;
    }

    h1 {
        color: #56b7ff;
        margin-bottom: 10px;
    }

    #gameBox {
        background: #1e1e1e;
        padding: 25px;
        border-radius: 12px;
        display: inline-block;
        width: 85%;
        max-width: 520px;
        box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    button {
        padding: 12px 25px;
        font-size: 18px;
        margin: 10px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        background: #56b7ff;
        color: #000;
        transition: 0.2s;
    }

    button:hover { background: #7ccaff; }

    input {
        padding: 10px;
        width: 80%;
        margin-top: 10px;
        font-size: 16px;
        border-radius: 6px;
        border: none;
    }

    #status { font-size: 20px; margin-bottom: 15px; }
    #result { margin-top: 15px; font-size: 22px; color: #ffdd57; }
</style>
</head>
<body>

<h1>üéß SoundGuessr</h1>

<div id="gameBox">
    <div id="status">≈Åadowanie listy d≈∫wiƒôk√≥w‚Ä¶</div>

    <button onclick="startGame()">START</button>
    <button onclick="repeatSound()">Odtw√≥rz ponownie (-50 pkt)</button>

    <br>

    <input id="answerInput" placeholder="Co to za d≈∫wiƒôk?" onkeydown="if(event.key==='Enter') checkAnswer()">
    <button onclick="checkAnswer()">OK</button>

    <div id="result"></div>
</div>

<script>
// ------------------- KONFIG -------------------

const GITHUB_API = "https://api.github.com/repos/SoundGuessr/soundguessr.github.io/contents/sounds";

// ------------------- ZMIENNE GRY -------------------

let sounds = [];        // lista plik√≥w z GitHuba
let pool = [];          // losowana 8-rundowa pula
let currentFile = "";   // aktualny plik
let audio = null;

let round = 1;
let score = 0;
let maxPoints = 1000;

let timeLeft = 30;
let timer = null;

// ------------------- POBIERANIE LISTY PLIK√ìW -------------------

fetch(GITHUB_API)
    .then(res => res.json())
    .then(data => {
        // filtrujemy tylko pliki .m4a
        sounds = data
            .filter(item => item.name.toLowerCase().endsWith(".m4a"))
            .map(item => ({
                file: item.name,
                url: item.download_url
            }));

        if (sounds.length === 0) {
            document.getElementById("status").innerText = "Brak plik√≥w .m4a w folderze!";
            return;
        }

        document.getElementById("status").innerText = "Kliknij START, aby zaczƒÖƒá!";
    })
    .catch(err => {
        console.error(err);
        document.getElementById("status").innerText = "B≈ÇƒÖd pobierania plik√≥w!";
    });

// ------------------- FUNKCJE GRY -------------------

function startGame() {
    if (sounds.length === 0) return;

    pool = [...sounds];     // dynamiczna pula z API
    round = 1;
    score = 0;
    maxPoints = 1000;

    document.getElementById("result").innerText = "";
    nextRound();
}

function nextRound() {
    if (round > 8) {
        document.getElementById("status").innerText =
            "Koniec gry! Tw√≥j wynik: " + score;
        return;
    }

    document.getElementById("answerInput").value = "";
    document.getElementById("result").innerText = "";

    // losowanie bez powt√≥rki
    const index = Math.floor(Math.random() * pool.length);
    const chosen = pool.splice(index, 1)[0];

    currentFile = chosen;
    audio = new Audio(chosen.url);
    audio.play();

    startTimer();

    document.getElementById("status").innerText =
        `Runda ${round} z 8 ‚Ä¢ 30s`;
}

function startTimer() {
    clearInterval(timer);
    timeLeft = 30;

    timer = setInterval(() => {
        document.getElementById("status").innerText =
            `Runda ${round} z 8 ‚Ä¢ ${timeLeft}s`;

        timeLeft--;

        if (timeLeft < 0) {
            clearInterval(timer);
            handleAnswer(false);
        }
    }, 1000);
}

function repeatSound() {
    if (!audio) return;

    audio.play();
    maxPoints -= 50;
    if (maxPoints < 0) maxPoints = 0;
}

function formatName(file) {
    let name = file.replace(/\.[^/.]+$/, "");     // usu≈Ñ .m4a
    name = name.replace(/[-_]/g, " ");            // my≈õlniki i _ ‚Üí spacje

    // wielkie litery
    return name
        .split(" ")
        .map(w => w.charAt(0).toUpperCase() + w.slice(1))
        .join(" ");
}

function checkAnswer() {
    const input = document.getElementById("answerInput").value.trim().toLowerCase();
    const correctName = formatName(currentFile.file).toLowerCase();

    const result = input !== "" && correctName.includes(input);

    handleAnswer(result);
}

function handleAnswer(correct) {
    clearInterval(timer);

    const pretty = formatName(currentFile.file);

    if (correct) {
        score += maxPoints;
        document.getElementById("result").innerText =
            `‚úîÔ∏è Dobrze! +${maxPoints} pkt`;
    } else {
        document.getElementById("result").innerText =
            `‚ùå ≈πle! To by≈Ço: ${pretty}`;
    }

    maxPoints = 1000;
    round++;

    setTimeout(nextRound, 1500);
}
</script>

</body>
</html>
