<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>SoundGuessr</title>

<!-- Puter AI -->
<script src="https://js.puter.com/v2/"></script>

<style>
body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    padding: 0;
    background: #121212;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    color: #eee;
}

#container {
    background: #1e1e1e;
    width: 95%;
    max-width: 480px;
    border-radius: 20px 18px 23px 19px;
    padding: 30px 22px;
    box-shadow: 0 7px 20px rgba(0,0,0,0.55), 0 2px 5px rgba(255,255,255,0.02);
    text-align: center;
    transition: all 0.4s ease;
}

h1 {
    font-size: 36px;
    margin-bottom: 24px;
    color: #ff6b6b;
    letter-spacing: 0.6px;
    transform: rotate(-0.3deg);
}

button {
    padding: 14px 28px;
    margin: 10px 7px;
    font-size: 18px;
    font-weight: 600;
    border-radius: 13px 15px 12px 16px;
    border: none;
    cursor: pointer;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
}

#startBtn {
    background: linear-gradient(48deg,#ff6b6b,#ff9b6b);
    color: #fff;
    font-size: 24px;
    width: 78%;
    margin-top: 22px;
    box-shadow: 0 0 10px rgba(255,107,107,0.5), inset 0 -2px 5px rgba(0,0,0,0.2);
}

#startBtn:disabled {
    cursor: default;
    opacity: 0.6;
}

#playBtn {
    background: linear-gradient(42deg,#6bffb0,#00c2ff);
    color: #000;
    font-size: 20px;
    box-shadow: 0 1px 8px rgba(0,194,255,0.5);
}

#playBtn:disabled {
    opacity: 0.5;
    cursor: default;
}

#guessBox input {
    width: 88%;
    padding: 12px;
    font-size: 18px;
    border-radius: 11px 13px 12px 14px;
    border: 2px solid #555;
    margin-top: 15px;
    background: #2a2a2a;
    color: #eee;
}

#guessBox button {
    background: linear-gradient(46deg,#ff6b6b,#ff9b6b);
    color: #fff;
    font-size: 18px;
    margin-top: 10px;
    box-shadow: 0 0 8px rgba(255,107,107,0.45);
}

#roundTimer {
    display: flex;
    justify-content: space-between;
    font-size: 22px;
    margin-bottom: 10px;
}

#progressContainer {
    width: 100%;
    height: 12px;
    background: #333;
    border-radius: 8px;
    margin-bottom: 14px;
}

#progressBar {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,#4ec3ff,#ff6b6b);
    border-radius: 8px;
    transition: width 0.48s ease;
}

#result {
    font-size: 22px;
    margin-top: 20px;
    min-height: 28px;
}

#backBtn {
    background: linear-gradient(44deg,#ffa500,#ff6b6b);
    color: #fff;
    font-size: 20px;
    padding: 14px 26px;
    border-radius: 14px 13px 12px 16px;
    margin-top: 15px;
    display: none;
    box-shadow: 0 0 9px rgba(255,165,0,0.45);
}
</style>
</head>
<body>

<div id="container">
    <h1>üéß SoundGuessr</h1>

    <button id="startBtn" disabled>≈Åadowanie...</button>

    <div id="gameArea" style="display:none;">

        <div id="progressContainer">
            <div id="progressBar"></div>
        </div>

        <div id="roundTimer">
            <div id="roundInfo">Runda 1 z 8</div>
            <div id="timer">30s</div>
        </div>

        <button id="playBtn" disabled>Odtwarzanie</button>
        <div id="info">Ka≈ºde dodatkowe odtworzenie: <b>-50 pkt</b></div>

        <div id="guessBox">
            <h2>Co to za d≈∫wiƒôk?</h2>
            <input id="answerInput" placeholder="np. Upadek Telefonu"
                onkeydown="if(event.key==='Enter') checkAnswer()">

            <button onclick="checkAnswer()">Zatwierd≈∫</button>
        </div>

        <div id="result"></div>
        <button id="backBtn" onclick="location.reload()">Powr√≥t do menu g≈Ç√≥wnego</button>
    </div>
</div>

<script>
const GITHUB_API = "https://api.github.com/repos/SoundGuessr/soundguessr.github.io/contents/sounds";

let sounds=[], pool=[], current=null, audio=null;
let round=1, score=0, maxPoints=1000, timeLeft=30, timer;

let startBtn = document.getElementById("startBtn");
let playBtn = document.getElementById("playBtn");
let progressBar = document.getElementById("progressBar");
let timerEl = document.getElementById("timer");

let loadingFrames=["≈Åadowanie.","≈Åadowanie..","≈Åadowanie...","≈Åadowanie"];
let li=0;

let loadingInterval=setInterval(()=>{
    startBtn.innerText=loadingFrames[li];
    li=(li+1)%loadingFrames.length;
},350);

fetch(GITHUB_API)
    .then(res=>res.json())
    .then(data=>{
        sounds = data.filter(x=>x.name.toLowerCase().endsWith(".m4a"))
                     .map(x=>({file:x.name,url:x.download_url}));

        clearInterval(loadingInterval);
        startBtn.innerText="Graj";
        startBtn.disabled=false;
    })
    .catch(()=>{
        clearInterval(loadingInterval);
        startBtn.innerText="B≈ÇƒÖd!";
    });

startBtn.onclick=()=>{
    startBtn.style.display="none";
    document.getElementById("gameArea").style.display="block";
    startGame();
};

function startGame(){
    pool=[...sounds];
    round=1; score=0;
    nextRound();
}

function updateProgress(){
    progressBar.style.width=((round-1)/8)*100+"%";
}

function nextRound(){
    document.getElementById("backBtn").style.display="none";
    if(audio) audio.pause();

    if(round>8){
        progressBar.style.width="100%";
        document.getElementById("result").innerHTML="<b>Tw√≥j wynik: "+score+" pkt</b>";
        playBtn.style.display="none";
        document.getElementById("guessBox").style.display="none";
        document.getElementById("backBtn").style.display="inline-block";
        document.getElementById("roundInfo").innerText="";
        timerEl.innerText="";
        return;
    }

    updateProgress();

    const idx=Math.floor(Math.random()*pool.length);
    current=pool.splice(idx,1)[0];

    document.getElementById("roundInfo").innerText=`Runda ${round} z 8`;
    timerEl.innerText="30s";
    document.getElementById("answerInput").value="";
    document.getElementById("result").innerText="";
    
    playBtn.innerText="Odtwarzanie";
    playBtn.disabled=true;

    audio=new Audio(current.url);
    audio.onended=()=>{
        playBtn.innerText="Odtw√≥rz ponownie";
        playBtn.disabled=false;
    };
    audio.play();
    startTimer();
}

function startTimer(){
    clearInterval(timer);
    timeLeft=30;

    timer=setInterval(()=>{
        timerEl.innerText=timeLeft+"s";
        timeLeft--;
        if(timeLeft<0){
            clearInterval(timer);
            handleAnswer(false);
        }
    },1000);
}

function playSound(){
    audio.play();
    maxPoints-=50;
    playBtn.disabled=true;
    playBtn.innerText="ZABLOKOWANY (Odtwarzanie)";
    audio.onended=()=>{
        playBtn.innerText="Odtw√≥rz ponownie";
        playBtn.disabled=false;
    }
}

function formatName(f){
    let name=f.replace(".m4a","");
    name=name.replace(/\d+$/,"");
    name=name.replace(/[-_]/g," ");
    return name.split(" ")
               .map(w=>w.charAt(0).toUpperCase()+w.slice(1))
               .join(" ");
}

/* üî•üî• AI CHECK ‚Äî najwa≈ºniejszy element üî•üî• */
async function aiCheck(correct, user) {
    const prompt = `
Prawid≈Çowa odpowied≈∫: "${correct}"
Odpowied≈∫ u≈ºytkownika: "${user}"

Je≈õli odpowied≈∫ u≈ºytkownika jest poprawna, synonimiczna lub bardzo bliska znaczeniowo ‚Üí wypisz tylko: y
Je≈õli jest b≈Çƒôdna ‚Üí wypisz tylko: n
NIC wiƒôcej.
    `;

    try {
        const res = await puter.ai.chat(prompt, {model:"gpt-5-nano"});
        const out = String(res).trim().toLowerCase();
        return out === "y";
    } catch {
        return false;
    }
}

async function checkAnswer(){
    let typed = document.getElementById("answerInput").value.trim();
    if(!typed) return;

    let correct=formatName(current.file);

    document.getElementById("answerInput").disabled=true;

    let ok = await aiCheck(correct, typed);

    document.getElementById("answerInput").disabled=false;

    handleAnswer(ok);
}

function handleAnswer(ok){
    clearInterval(timer);
    if(ok){
        score+=maxPoints;
        document.getElementById("result").innerHTML=`<span style="color:#2ecc71;">‚úî Dobrze! +${maxPoints} pkt</span>`;
    } else {
        document.getElementById("result").innerHTML=`<span style="color:#e74c3c;">‚úò ≈πle! To by≈Ço: ${formatName(current.file)}</span>`;
    }

    maxPoints=1000;
    round++;
    setTimeout(nextRound,1500);
}
</script>
</body>
</html>
